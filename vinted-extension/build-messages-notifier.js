#!/usr/bin/env node
// Script simple pour bundler le systÃ¨me de notifications de messages
// Usage: node build-messages-notifier.js

const fs = require('fs');
const path = require('path');

console.log('ðŸ”¨ Building messages-notifier bundle...');

// Lire les fichiers sources
const messagesApi = fs.readFileSync(path.join(__dirname, 'js/messagesApi.js'), 'utf8');
const messagesNotifier = fs.readFileSync(path.join(__dirname, 'js/messagesNotifier.js'), 'utf8');
const itemDetails = fs.readFileSync(path.join(__dirname, 'js/itemDetails.js'), 'utf8');
const messagesInit = fs.readFileSync(path.join(__dirname, 'messages-notifier-init.js'), 'utf8');

// Retirer les imports/exports et crÃ©er un bundle IIFE
const bundle = `
// ==========================================
// VINTED MESSAGE NOTIFIER - BUNDLED VERSION
// Auto-generated by build-messages-notifier.js
// ==========================================

(function() {
  'use strict';
  
  // ==========================================
  // messagesApi.js
  // ==========================================
  
  ${messagesApi
    .replace(/export async function/g, 'async function')
    .replace(/export function/g, 'function')
  }
  
  // ==========================================
  // messagesNotifier.js
  // ==========================================
  
  ${messagesNotifier
    .replace(/import \{[^}]+\} from ['"][^'"]+['"];?\n/g, '')
    .replace(/export function/g, 'function')
  }
  
  // ==========================================
  // itemDetails.js
  // ==========================================
  
  ${itemDetails
    .replace(/import \{[^}]+\} from ['"][^'"]+['"];?\n/g, '')
    .replace(/export function/g, 'function')
    .replace(/export async function/g, 'async function')
  }
  
  // ==========================================
  // Initialization
  // ==========================================
  
  ${messagesInit
    .replace(/import \{[^}]+\} from ['"][^'"]+['"];?\n/g, '')
  }
  
})();
`;

// Ã‰crire le bundle
const outputPath = path.join(__dirname, 'messages-notifier-bundled.js');
fs.writeFileSync(outputPath, bundle, 'utf8');

console.log('âœ… Bundle created:', outputPath);
console.log('ðŸ“¦ Size:', (bundle.length / 1024).toFixed(2), 'KB');

